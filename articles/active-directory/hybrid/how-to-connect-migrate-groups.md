---
title: 'Azure AD Connect: Migrieren von Gruppen aus einer Gesamtstruktur in eine andere'
description: In diesem Artikel werden die erforderlichen Schritte zum erfolgreichen Migrieren von Gruppen aus einer Gesamtstruktur in eine andere mit Azure AD Connect beschrieben.
services: active-directory
author: billmath
manager: daveba
ms.service: active-directory
ms.topic: how-to
ms.workload: identity
ms.date: 04/02/2020
ms.subservice: hybrid
ms.author: billmath
ms.collection: M365-identity-device-management
ms.openlocfilehash: 5ef693a48dc52854e4e1fd8359ef24f65ce236f7
ms.sourcegitcommit: 829d951d5c90442a38012daaf77e86046018e5b9
ms.translationtype: HT
ms.contentlocale: de-DE
ms.lasthandoff: 10/09/2020
ms.locfileid: "85358581"
---
# <a name="migrate-groups-from-one-forest-to-another-for-azure-ad-connect"></a>Migrieren von Gruppen aus einer Gesamtstruktur zu einer anderen mit Azure AD Connect

In diesem Artikel wird beschrieben, wie Gruppen aus einer Gesamtstruktur in eine andere migriert werden, sodass die migrierten Gruppenobjekte mit den in der Cloud vorhandenen Objekten übereinstimmen.

## <a name="prerequisites"></a>Voraussetzungen

- Azure AD Connect Version 1.5.18.0 oder höher
- Quellankerattribut auf `mS-DS-ConsistencyGuid` festgelegt

## <a name="migrate-groups"></a>Migrieren von Gruppen

Ab Version 1.5.18.0 unterstützt Azure AD Connect die Verwendung des Attributs `mS-DS-ConsistencyGuid` für Gruppen. Wenn `mS-DS-ConsistencyGuid` als Quellankerattribut ausgewählt und der Wert in Active Directory aufgefüllt wird, verwendet Azure AD Connect den Wert `mS-DS-ConsistencyGuid` als `immutableId`. Andernfalls wird ein Fallback auf `objectGUID` ausgeführt. Beachten Sie jedoch, dass Azure AD Connect den Wert NICHT an das Attribut `mS-DS-ConsistencyGuid` in Active Directory zurückschreibt.

Bei einer Verschiebung zwischen Gesamtstrukturen, bei der ein Gruppenobjekt von einer Gesamtstruktur (z. B. F1) in eine andere Gesamtstruktur (z. B. F2) verschoben wird, müssen Sie entweder den Wert `mS-DS-ConsistencyGuid` (sofern vorhanden) oder den Wert `objectGUID` des Objekts in Gesamtstruktur F1 in das Attribut `mS-DS-ConsistencyGuid` des Objekts in Gesamtstruktur F2 kopieren.

Verwenden Sie die folgenden Skripts als Leitfaden, um zu erfahren, wie Sie eine einzelne Gruppe von einer Gesamtstruktur in eine andere migrieren. Sie können diese Skripts auch als Leitfaden für die Migration mehrerer Gruppen verwenden. In den Skripts wird für die Quellgesamtstruktur der Name F1 und für die Zielgesamtstruktur der Name F2 verwendet.

Zunächst werden die Werte `objectGUID` und `mS-DS-ConsistencyGuid` des Gruppenobjekts in der Gesamtstruktur F1 abgerufen. Diese Attribute werden in eine CSV-Datei exportiert.
```
<#
DESCRIPTION
============
This script will take DN of a group as input.
It then copies the objectGUID and mS-DS-ConsistencyGuid values along with other attributes of the given group to a CSV file.

This CSV file can then be used as input to the Export-Group script.
#>
Param(
       [ValidateNotNullOrEmpty()]
       [string]
       $dn,

       [ValidateNotNullOrEmpty()]
       [string]
       $outputCsv
)

$defaultProperties = @('samAccountName', 'distinguishedName', 'objectGUID', 'mS-DS-ConsistencyGuid')
$group  = Get-ADGroup -Filter "DistinguishedName -eq '$dn'" -Properties $defaultProperties -ErrorAction Stop
$results = @()
if ($group -eq $null)
{
       Write-Error "Group not found"
}
else
{
       $objectGUIDValue = [GUID]$group.'objectGUID'
       $mSDSConsistencyGuidValue = "N/A"
       if ($group.'mS-DS-ConsistencyGuid' -ne $null)
       {
              $mSDSConsistencyGuidValue = [GUID]$group.'mS-DS-ConsistencyGuid'
       }
       $adgroup = New-Object -TypeName PSObject
       $adgroup | Add-Member -MemberType NoteProperty -Name samAccountName -Value $($group.'samAccountName')
       $adgroup | Add-Member -MemberType NoteProperty -Name distinguishedName -Value $($group.'distinguishedName')
       $adgroup | Add-Member -MemberType NoteProperty -Name objectGUID -Value $($objectGUIDValue)
       $adgroup | Add-Member -MemberType NoteProperty -Name mS-DS-ConsistencyGuid -Value $($mSDSConsistencyGuidValue)
       $results += $adgroup
}

Write-Host "Exporting group to output file"
$results | Export-Csv "$outputCsv" -NoTypeInformation

```

Anschließend verwenden Sie die generierte CSV-Ausgabedatei, um das Attribut `mS-DS-ConsistencyGuid` für das Zielobjekt in der Gesamtstruktur F2 zu stempeln:


```
<#
DESCRIPTION
============
This script will take DN of a group as input and the CSV file that was generated by the Import-Group script.
It copies either the objectGUID or the mS-DS-ConsistencyGuid value from the CSV file to the given object.

#>
Param(
       [ValidateNotNullOrEmpty()]
       [string]
       $dn,

       [ValidateNotNullOrEmpty()]
       [string]
       $inputCsv
)

$group  = Get-ADGroup -Filter "DistinguishedName -eq '$dn'" -ErrorAction Stop
if ($group -eq $null)
{
       Write-Error "Group not found"
}

$csvFile = Import-Csv -Path $inputCsv -ErrorAction Stop
$msDSConsistencyGuid = $csvFile.'mS-DS-ConsistencyGuid'
$objectGuid = [GUID] $csvFile.'objectGUID'
$targetGuid = $msDSConsistencyGuid

if ($msDSConsistencyGuid -eq "N/A")
{
       $targetGuid = $objectGuid
}

Set-ADGroup -Identity $dn -Replace @{'mS-DS-ConsistencyGuid'=$targetGuid} -ErrorAction Stop

```

## <a name="next-steps"></a>Nächste Schritte
Erfahren Sie mehr zum [Integrieren lokaler Identitäten in Azure Active Directory](whatis-hybrid-identity.md).
